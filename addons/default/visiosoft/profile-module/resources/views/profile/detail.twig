{% extends "theme::layouts/default" %}

{% block content %}
    {% embed 'visiosoft.module.profile::profile/index' %}
        {% block detail %}
            {% set profile_photo = user.file %}
            {% if profile_photo %}
                {% set profile_photo = file(profile_photo.id).url %}
            {% else %}
                {% set profile_photo = img('visiosoft.module.profile::images/profile-default.png').url %}
            {% endif %}

            <div class="row px-3">

                <!-- User Profile Form Section-->
                <div class="col-md-12 mt-5 bg-light profile-section pb-4">
                    <nav>
                        <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active text-dark" id="nav-profile-tab" data-toggle="tab"
                               href="#nav-profile"
                               role="tab" aria-controls="nav-profile" aria-selected="true">
                                <img src="{{ img('visiosoft.module.profile::images/user.svg').url }}" alt="">
                                {{ trans('visiosoft.module.profile::field.profile.name') }}
                            </a>
                            <a class="nav-item nav-link text-dark" id="nav-details-tab" data-toggle="tab"
                               href="#nav-details"
                               role="tab" aria-controls="nav-details" aria-selected="false">
                                <img src="{{ img('visiosoft.module.profile::images/detail.svg').url }}" alt="">
                                {{ trans('visiosoft.module.profile::field.details.name') }}
                            </a>
                            <a class="nav-item nav-link text-dark" id="nav-password-tab" data-toggle="tab"
                               href="#nav-password"
                               role="tab" aria-controls="nav-password" aria-selected="false">
                                <img src="{{ img('visiosoft.module.profile::images/password.svg').url }}" alt="">
                                {{ trans('visiosoft.module.profile::field.password.name') }}
                            </a>
                            {{ addBlock('profile/detail/content-tab')|raw }}
                        </div>
                    </nav>

                    <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-profile" role="tabpanel"
                             aria-labelledby="nav-profile-tab">
                            <div>
                                {% set userForm = form('userProfile').entry(user.id).get() %}
                                {{ userForm.open()|raw }}
                                <div class="mt-4 d-flex profile--desc">
                                    <div class="ml-4">
                                        <img src="{{ profile_photo }}">
                                    </div>
                                    <div class="ml-3 pt-2">
                                        <p class="mb-1 username">{{ user.name }}</p>
                                        <p class="mb-1 last-login">{{ auth_user().last_login_at|date("d.m.Y - H:i") }}</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="profile--form--area">
                                        <div class="form-group">
                                            <label class="control-label font-weight-bold" for="">
                                                {{ trans("visiosoft.module.profile::field.first_name.name") }}
                                            </label>
                                            {{ userForm.fields.first_name.input|raw }}

                                        </div>
                                        <div class="form-group">
                                            <label class="control-label font-weight-bold" for="">
                                                {{ trans("visiosoft.module.profile::field.last_name.name") }}
                                            </label>
                                            {{ userForm.fields.last_name.input|raw }}
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label font-weight-bold" for="">
                                                {{ trans("visiosoft.module.profile::field.email.name") }}
                                            </label>
                                            {{ userForm.fields.email.input|raw }}
                                        </div>
                                    </div>
                                    <div class="form-group text-right pr-3">
                                        {{ userForm.actions|raw }}
                                    </div>

                                    <div class="account--disable--content d-flex align-item-center justify-content-center mx-auto">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <p class="mb-0 mr-4">
                                                {{ trans('visiosoft.module.profile::message.disable_account') }}
                                            </p>
                                            <button type="button" class="btn btn-danger"
                                                    onclick="window.location.href='/profile/closeAccount'">
                                                {{ trans("visiosoft.module.profile::field.disable_account.name") }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-details" role="tabpanel"
                             aria-labelledby="nav-details-tab">
                            {% set profileForm = form('profile').entry(user.id).get() %}
                            {{ profileForm.open()|raw }}
                            <div class="row">
                                <div class="col-md-12">
                                    {% if setting_value('visiosoft.module.profile::upload_avatar') %}
                                        <div class="form-group">
                                            {{ profileForm.fields.file|raw }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <div class=" form-group">
                                        <label class="control-label font-weight-bold">{{ trans("visiosoft.module.profile::field.identification_number.name") }}</label>
                                        {{ profileForm.fields.identification_number.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group required-profile-phone-field">
                                        <label class="control-label font-weight-bold">
                                            {{ profileForm.fields.gsm_phone.label }}
                                        </label>
                                        {{ profileForm.fields.gsm_phone.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group required-profile-phone-field">
                                        <label class="control-label font-weight-bold">
                                            {{ profileForm.fields.office_phone.label }}
                                        </label>
                                        {{ profileForm.fields.office_phone.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group required-profile-phone-field">
                                        <label class="control-label font-weight-bold">
                                            {{ profileForm.fields.land_phone.label }}
                                        </label>
                                        {{ profileForm.fields.land_phone.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label font-weight-bold">{{ trans("visiosoft.module.profile::field.register_type.name") }}</label>
                                        {{ profileForm.fields.register_type.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-12 text-right">
                                    <div class="form-group">
                                        {{ profileForm.actions|raw }}
                                    </div>

                                </div>
                            </div>
                                {{ profileForm.close()|raw }}
                        </div>
                        <div class="tab-pane fade" id="nav-password" role="tabpanel" aria-labelledby="nav-password-tab">
                            {% set passwordForm = form('updatePassword').get() %}

                            {{ passwordForm.open()|raw }}
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="font-weight-bold">{{ trans("visiosoft.module.profile::field.new_password.name") }}</label>
                                        {{ passwordForm.fields.new_password.input|raw }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="font-weight-bold">{{ trans("visiosoft.module.profile::field.re_new_password.name") }}</label>
                                        {{ passwordForm.fields.re_new_password.input|raw }}
                                    </div>
                                </div>
                            </div>
                            <div class="form-group text-right">
                                {{ passwordForm.actions|raw }}
                            </div>
                        </div>
                        {{ passwordForm.close|raw }}
                        {{ addBlock('profile/detail/content')|raw }}
                    </div>
                    <!-- User Profile Form Section-->
                </div>
            </div>
        {% endblock %}
    {% endembed %}

    {{ asset_add("scripts.js", "visiosoft.module.profile::assets/js/profile.js") }}
{% endblock %}